# ä¸€ã€HTTP

![image-20211006022605693](image-20211006022605693.png)



1ã€ HTTPåè®®æ˜¯80ç«¯å£ï¼Œé»˜è®¤ä¸ç”¨å†™ï¼Œå†™äº†ä¹Ÿæ²¡é—®é¢˜

2ã€ HTTPSåè®®ç«¯å£æ˜¯443ï¼Œé»˜è®¤ä¸ç”¨å†™ï¼Œå†™äº†ä¹Ÿæ²¡é—®é¢˜

3ã€ é”šç‚¹ï¼šå®šä½çš„ä¾‹å­ï¼Œç™¾åº¦ç™¾ç§‘ã€ç½‘æ˜“äº‘ï¼Œ #valueå‰ç«¯å®šä½ï¼Œ #/value å¯¼èˆªï¼ˆæ ¹æ®è¿™ä¸ªé”šç‚¹å»è¯·æ±‚æ•°æ®ï¼‰

![image-20211006022800162](image-20211006022800162.png)



![image-20211006022854224](image-20211006022854224.png)

4ã€ urlå‚æ•°ä½¿ç”¨ï¼›å·è¿›è¡Œåˆ†å‰²æ¯”å¦‚'http://www.xyz.com/aa.html;aoteman?param=xxx#bb.html'ï¼Œaotemanå°±æ˜¯å‚æ•°

**çŠ¶æ€ç **

![image-20211006024111787](image-20211006024111787.png)

ä¸€èˆ¬é‡å®šå‘302ï¼Œè§åˆ°çš„æ¯”è¾ƒå¤š



# äºŒã€request

åœ¨python3çš„urllibåº“ä¸­ï¼Œæ‰€æœ‰å’Œç½‘ç»œè¯·æ±‚ç›¸å…³çš„æ–¹æ³•ï¼Œéƒ½è¢«é›†åˆ°urllib.requestæ¨¡å—ä¸‹é¢äº†ï¼Œä»¥å…ˆæ¥çœ‹ä¸€ä¸‹urlopenå‡½æ•°åŸºæœ¬ä½¿ç”¨

```python
from urllib import request
resp = request.urlopen('http://www.baidu.com')
print(resp.read())								# è¿”å›çš„æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼Œè¦è¿›è¡Œç¼–ç 
```

ä¸€ä¸ªåŸºæœ¬çš„urlè¯·æ±‚å¯¹åº”çš„pythonä»£ç çœŸçš„éå¸¸ç®€å•ã€‚ä¸Šé¢çš„ä»£ç ï¼Œè¿”å›çš„ä¸æ˜¯ç™¾åº¦çš„æºç ï¼Œå› ä¸ºç™¾åº¦æœ¬æ¥å°±æ˜¯ä¸€ä¸ªåšçˆ¬è™«çš„ï¼Œåˆ«äººä¸€ä¸‹å°±æŠŠæˆ‘ç»™è¯†ç ´äº†ï¼Œè¿”å›äº†å…¶ä»–çš„ä¸œè¥¿





## 1ã€request.urlopen

![image-20211006030316701](image-20211006030316701.png)

```
def urlopen(url, data=None, timeout=socket._GLOBAL_DEFAULT_TIMEOUT,
            *, cafile=None, capath=None, cadefault=False, context=None):
```

åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºè¿œç¨‹urlçš„ç±»çš„æ–‡ä»¶å¯¹è±¡ï¼Œç„¶ååƒæœ¬åœ°æ–‡ä»¶ä¸€æ ·æ“ä½œè¿™ä¸ªç±»æ–‡ä»¶å¯¹è±¡æ¥è·å–è¿œç¨‹æ•°æ®

1ã€urlï¼š è¯·æ±‚çš„url

2ã€dataï¼šè¯·æ±‚çš„dataï¼Œå¦‚æœè®¾ç½®äº†è¿™ä¸ªå€¼ï¼Œé‚£ä¹ˆå°†å˜æˆpostè¯·æ±‚

3ã€è¿”å›å€¼ï¼šè¿”å›å€¼æ˜¯ä¸€ä¸ªhttp.client.HTTPResponseå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ªç±»æ–‡ä»¶å¥æŸ„å¯¹è±¡ã€‚æœ‰read(size)ã€ readlineã€readlinesä»¥åŠgetcodeç­‰æ–¹æ³•. read()ä»¥åï¼Œæ–‡ä»¶æŒ‡é’ˆå°±æŒ‡å‘æœ«å°¾äº†ï¼Œå†æ¬¡readå°±ä¼šè¯»å‡ºä¸€ä¸ªç©ºå­—ç¬¦ã€‚è·Ÿè¯»æ–‡ä»¶å¾ˆæƒ³ï¼Œä½†æ˜¯æˆ‘è¯•äº†seekæ–¹æ³•ï¼Œæ²¡ç”¨ï¼Œè¯´æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ã€‚



## 2ã€request.urlretrieve

![image-20211006033516228](image-20211006033516228.png)

```python
def urlretrieve(url, filename=None, reporthook=None, data=None):
```

è¿™ä¸ªå‡½æ•°å¯ä»¥æ–¹ä¾¿çš„å°†ç½‘é¡µä¸Šçš„ä¸€ä¸ªæ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°

```
from urllib import request
res = request.urlretrieve('https://www.xxx.jpg', 'xxxxx.jpg')	# å°†ä¸€ä¸ªå›¾ç‰‡ä¿å­˜åˆ°å½“å‰ç›®å½•ä¸‹xxxxx.jpgæ–‡ä»¶ä¸­
```

resæ˜¯ä¸€ä¸ªå…ƒç»„

```
('xxxxx.jpg', <http.client.HTTPMessage object at 0x0000021AD2DC5EF0>)
```

res[1]æœ‰å¾ˆå¤šä¸ªæ–¹æ³•

![image-20211006033826605](image-20211006033826605.png)

æˆ‘ä»¬æ¥çœ‹çœ‹res[1]åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿

```python
print(res[1])	# æ„Ÿè§‰åƒä¸€ä¸ªå“åº”å¤´

Server: JSP3/2.0.14
Date: Tue, 05 Oct 2021 19:39:26 GMT
Content-Type: image/jpeg
Content-Length: 24005
Connection: close
Last-Modified: Fri, 18 Oct 2019 12:01:16 GMT
Expires: Thu, 16 Sep 2021 19:08:15 GMT
Age: 736
Accept-Ranges: bytes
Content-MD5: jMYJYqqTdB7QQOhyaJ7Zrg==
Vary: Accept
x-bce-debug-id: y7vvi1mTbZVSooaLBjeS5BNwJvk8gBHUIKMvtiN1kYtb75g1OF7elAgkBco8QwrzOmJXPJXtteC8Q7xMlgbvxg==
x-bce-image-info: width=220;height=298
x-bce-request-id: c55af2fd-de2f-4298-ad26-213258c75586
x-bce-storage-class: STANDARD
Access-Control-Allow-Origin: *
Timing-Allow-Origin: *
Ohc-Cache-HIT: dy2ct54 [4], bdix156 [4]
Ohc-File-Size: 24005
```



# äºŒã€ç¼–ç è§£ç 



## 1ã€ parse.urlencode

urlencodeå¯ä»¥æŠŠå­—å…¸æ•°æ®è½¬æ¢ä¸ºurlç¼–ç æ•°æ®ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```python
from urllib import parse
data = {'name': 'çˆ¬è™«åŸºç¡€', 'greet': 'hello world', 'age': 100}
qs = parse.urlencode(data)
print(qs)
name=%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80&greet=hello+world&age=100
```

ğŸ”ºå¤‡æ³¨ï¼šè¿”å›çš„qsæ˜¯å¾ˆæœ‰æ„æ€çš„

- æ±‰å­—è¢«å˜æˆäº†åå…­è¿›åˆ¶çš„hex()ï¼Œå¹¶ç”¨%æ›¿ä»£äº†0x
- å¦‚æœå‚æ•°æœ‰ç©ºæ ¼ï¼Œç”¨åŠ å·æ›¿ä»£ç©ºæ ¼ï¼Œæœ‰å‡ ä¸ªç©ºæ ¼ï¼Œå°±ç”¨å‡ ä¸ªåŠ å·



ä¸ºä»€ä¹ˆè¦ç¼–ç å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬è¯·æ±‚çš„urlï¼Œå¿…é¡»æ»¡è¶³urlç¼–ç è§„åˆ™ï¼Œä»€ä¹ˆæ˜¯urlç¼–ç è§„åˆ™å‘¢ï¼Ÿ

urlç¼–ç è§„åˆ™

- é‡‡ç”¨ASCIIç è¿›è¡Œç¼–ç urlï¼Œæ‰èƒ½è¿›è¡Œä¼ è¾“ï¼ˆå›½é™…è§„èŒƒï¼‰ï¼Œæ‰€ä»¥å¯¹æ±‰å­—ä¸å‹å¥½ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨æµè§ˆå™¨çš„æ—¶å€™ï¼Œæ˜¯æµè§ˆå™¨å¸®æˆ‘ä»¬è¿›è¡Œå¤„ç†äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡æœ‰ä»€ä¹ˆæ„ŸçŸ¥
- æµè§ˆå™¨æ˜¯è¿™æ ·å¤„ç†çš„ï¼Œå°†æ±‰å­—è¿›è¡Œé‡‡ç”¨utf8ç¼–ç ï¼Œç„¶åå–å®ƒçš„hex(),ç„¶åç”¨ç™¾åˆ†å·æ›¿ä»£0x

æˆ‘æ‰‹åŠ¨æ¥å¤„ç†ä¸€ä¸‹

```python
>>> from urllib import parse
>>> a = 'å¼ æ˜æŸ±'

>>> b = a.encode('utf8')
>>> b
b'\xe5\xbc\xa0\xe6\x98\x8e\xe6\x9f\xb1'

>>> c = [hex(i) for i in b]
>>> c
['0xe5', '0xbc', '0xa0', '0xe6', '0x98', '0x8e', '0xe6', '0x9f', '0xb1']

>>> d = ''.join(c)
>>> c = d.replace('0x', '%')
>>> c
'%e5%bc%a0%e6%98%8e%e6%9f%b1'

>>> parse.unquote(c)
'å¼ æ˜æŸ±'

>>> parse.quote('å¼ æ˜æŸ±')
'%E5%BC%A0%E6%98%8E%E6%9F%B1'
```

åŒç†ï¼Œå½“æˆ‘ä»¬è¦æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªå­—å…¸ï¼Œè¿™ä¸ªæ•°æ®å¦‚æœè¦åŠ å…¥åˆ°urlå½“ä¸­çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦å¤„ç†ã€‚urllibç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªä»–ä»¬å°è£…çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯urlencodeï¼ˆï¼‰ï¼Œurlencodeå¿…é¡»ä¼ å…¥é”®å€¼å…³ç³»çš„åºåˆ—å¦‚æœå­—å…¸æˆ–è€…mappingå¯¹è±¡ï¼ˆenumerateï¼‰ï¼Œæˆ‘è¯•äº†è¯•å¥½åƒå°±åªæœ‰å­—å…¸å’Œenumerateå¯¹è±¡

ğŸ”ºæ³¨æ„ï¼šå¦‚æœä¸€ä¸ªurlå·²ç»è¢«ç¼–ç äº†ï¼Œæˆ‘ä»¬æ‰§è¡Œquoteç¼–ç ï¼Œå®ƒå¾ˆæœ‰å¯èƒ½æ˜¯è¦æŠ¥é”™çš„ï¼Œå› ä¸ºå®ƒä¼šæŠŠå‰é¢çš„urlä¹Ÿç¼–ç äº†ã€‚æ‰€ä»¥å•Šï¼Œæˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨ä¸Šé¢çš„æ–¹å¼åªé’ˆå¯¹æ±‰å­—å»æ‰§è¡Œquoteï¼Œä¸è¦æŠŠæ•´ä¸ªurlæ¥ä½¿ç”¨quoteï¼Œä¸ç„¶ä½ çš„urlæ•´ä½“éƒ½å˜äº†ã€‚



## 2ã€parse.unquote å’Œ parse.parse_qsã€parse.parse_qsl

**parse.unquote**

> ä¼šå°†ç™¾åˆ†å·ç¼–ç çš„è¿›è¡Œè¿˜åŸï¼Œè¿”å›ä¸€ä¸ªè§£ç åçš„å­—ç¬¦ä¸²
>
> ```python
> a = '%E7%9F%B3%E5%8E%9F%E9%87%8C%E7%BE%8E'
> parse.unquote(a)
> 'çŸ³åŸé‡Œç¾'
> ```
>
> ğŸ”ºunquoteæˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥å°†urlæ”¾è¿›æ¥ï¼Œurllibä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åˆ†æã€‚è·Ÿquoteä½¿ç”¨çš„æ—¶å€™ï¼Œè¿˜æ˜¯ä¸å¤ªä¸€æ ·ï¼Œquoteä¸ä¼šè¿›è¡Œåˆ¤æ–­ã€‚



****

**parse.parse_qs**

>ä¼šå°†æ•´ä¸ªurlè¿›è¡Œæ‹†åˆ†ï¼Œæ‹†åˆ†æˆä¸€ä¸ªé”®å€¼å¯¹çš„å­—å…¸
>
>```python
>a = 'https://www.baidu.com/s?ie=utf-8&f=8&rsv_bp=1&rsv_idx=1&tn=baidu&wd=%E7%9F%B3%E5%8E%9F%E9%87%8C%E7%BE%8E'
>parse.parse_qs(a)
>{'https://www.baidu.com/s?ie': ['utf-8'], 'f': ['8'], 'rsv_bp': ['1'], 'rsv_idx': ['1'], 'tn': ['baidu'], 'wd': ['çŸ³åŸé‡Œç¾']}
>```



****

**parse.parse_qsl**

> ä¼šå°†æ•´ä¸ªurlæ‹†åˆ†ï¼Œæ‹†åˆ†é•¿ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨é‡Œé¢å¥—ä¸€ä¸ªå…ƒç´ 
>
> ```python
> a = 'https://www.baidu.com/s?ie=utf-8&f=8&rsv_bp=1&rsv_idx=1&tn=baidu&wd=%E7%9F%B3%E5%8E%9F%E9%87%8C%E7%BE%8E'
> parse.parse_qsl(a)
> [('https://www.baidu.com/s?ie', 'utf-8'), ('f', '8'), ('rsv_bp', '1'), ('rsv_idx', '1'), ('tn', 'baidu'), ('wd', 'çŸ³åŸé‡Œç¾')]
> ```



## 3ã€å…¶ä»–

urlparseæ¨¡å—ä¸»è¦æ˜¯æŠŠurlæ‹†åˆ†ä¸º6éƒ¨åˆ†ï¼Œå¹¶è¿”å›å…ƒç»„ã€‚å¹¶ä¸”å¯ä»¥æŠŠæ‹†åˆ†åçš„éƒ¨åˆ†å†ç»„æˆä¸€ä¸ªurlã€‚ä¸»è¦æœ‰å‡½æ•°æœ‰urljoinã€urlsplitã€urlunsplitã€urlparseç­‰ã€‚

#### 1ã€urlparse

- æ˜¯åŸºäºnamedtupleï¼Œæ˜¯tupleçš„å­ç±»ã€‚å®ƒæ”¯æŒé€šè¿‡åå­—å±æ€§æˆ–è€…ç´¢å¼•è®¿é—®çš„éƒ¨åˆ†URLï¼Œæ¯ä¸ªç»„ä»¶æ˜¯ä¸€ä¸²å­—ç¬¦ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ç©ºçš„
- **#**å·æ˜¯åˆ†æ®µçš„æ ‡è¯†

```python
>>> a
'http://www.xyz.com/aa.html?param=xxx#bb.html'
>>> b = parse.urlparse(a)
ParseResult(scheme='http', netloc='www.xyz.com', path='/aa.html', params='', query='param=xxx', fragment='bb.html')

# è·å–å…ƒç´ å¯ä»¥é€šè¿‡ç´¢å¼•æˆ–è€…keyè¿›è¡Œè·å–
>>> b.scheme
'http'
>>> b[0]
'http'

# å¦‚æœallow_fragments = Falseçš„æ—¶å€™,åˆ†æ®µå°†ä¼šè¢«å½’å…¥queryé‡Œé¢
>>> parse.urlparse(a, allow_fragments=False)
ParseResult(scheme='http', netloc='www.xyz.com', path='/aa.html', params='aoteman', query='param=xxx#bb.html', fragment='')
```



#### 2ã€urlunparse

- ä»ä¸€ä¸ªå…ƒç»„æ„å»ºä¸€ä¸ªurlï¼Œå…ƒç»„ç±»ä¼¼urlparseè¿”å›çš„ï¼Œå®ƒæ¥æ”¶å…ƒç»„(scheme, netloc, path, parameters, query, fragment)åï¼Œä¼šé‡æ–°ç»„æˆä¸€ä¸ªå…·æœ‰æ­£ç¡®æ ¼å¼çš„URLï¼Œä»¥ä¾¿ä¾›Pythonçš„å…¶ä»–HTMLè§£ææ¨¡å—ä½¿ç”¨

- å°±æ˜¯urlparseçš„é€†å‘

```python
>>> a
'http://www.xyz.com/aa.html?param=xxx#bb.html'
>>> b = parse.urlparse(a)
ParseResult(scheme='http', netloc='www.xyz.com', path='/aa.html', params='', query='param=xxx', fragment='bb.html')

>>> parse.urlunparse(b)
'http://www.xyz.com/aa.html?param=xxx#bb.html'
```

è¿™é‡Œæˆ‘ä»¬å¼•å…¥ParseResultå…ƒç»„

```python
c = parse.ParseResult(scheme='http', netloc='www.xyz.com', path='/aa.html', params='aoteman', query='param=xxx', fragment='bb.html')

# ç„¶åä½¿ç”¨urlunparseè¿›è¡Œç»„åˆ
>>> parse.urlunparse(c)
'http://www.xyz.com/aa.html;å¼ æ˜æŸ±?param=xxx#bb.html'
```

åŒç†è¿˜æœ‰å…¶ä»–çš„Resultå…ƒç»„æ¯”å¦‚

- parse.DefragResult(url, fragment)
- parse.SplitResult(scheme, netloc, path, query, fragment)



#### 3ã€urlparse.urlsplit(urlstring[, scheme[, allow_fragments]])

ä¸»è¦æ˜¯åˆ†æurlstringï¼Œè¿”å›ä¸€ä¸ªåŒ…å«5ä¸ªå­—ç¬¦ä¸²é¡¹ç›®çš„å…ƒç»„ï¼šåè®®ã€ä½ç½®ã€è·¯å¾„ã€æŸ¥è¯¢ã€ç‰‡æ®µã€‚allow_fragmentsä¸ºFalseæ—¶ï¼ˆé»˜è®¤æ˜¯Trueï¼‰ï¼Œè¯¥å…ƒç»„çš„ç»„åä¸€ä¸ªé¡¹ç›®æ€»æ˜¯ç©ºï¼Œä¸ç®¡urlstringæœ‰æ²¡æœ‰ç‰‡æ®µï¼Œçœç•¥é¡¹ç›®çš„ä¹Ÿæ˜¯ç©ºã€‚urlsplit()å’Œurlparse()å·®ä¸å¤šã€‚ä¸è¿‡å®ƒä¸åˆ‡åˆ†URLçš„å‚æ•°ã€‚é€‚ç”¨äºéµå¾ªRFC2396çš„URLï¼Œæ¯ä¸ªè·¯å¾„æ®µéƒ½æ”¯æŒå‚æ•°ã€‚è¿™æ ·è¿”å›çš„å…ƒç»„å°±åªæœ‰5ä¸ªå…ƒç´ ã€‚

```python
a = 'http://www.xyz.com/aa.html;aoteman?param=xxx#bb.html'
>>> parse.urlsplit(a)
SplitResult(scheme='http', netloc='www.xyz.com', path='/aa.html;aoteman', query='param=xxx', fragment='bb.html')

>>> parse.urlparse(a)
ParseResult(scheme='http', netloc='www.xyz.com', path='/aa.html', params='aoteman', query='param=xxx', fragment='bb.html')

# å¦‚æœallow_fragments = Falseçš„æ—¶å€™,åˆ†æ®µå°†ä¼šè¢«å½’å…¥queryé‡Œé¢
>>> parse.urlsplit(a, allow_fragments=False)
SplitResult(scheme='http', netloc='www.xyz.com', path='/aa.html;aoteman', query='param=xxx#bb.html', fragment='')
```



#### 4ã€urlunsplit

```python
a = 'http://www.xyz.com/aa.html;aoteman?param=xxx#bb.html'
>>> parse.urlunsplit(parse.urlsplit(a, allow_fragments=False))
'http://www.xyz.com/aa.html;aoteman?param=xxx#bb.html'
```

å¼•å…¥SplitResult

```python
>>> a = parse.SplitResult(scheme='http', netloc='www.xyz.com', path='/aa.html;aoteman', query='param=xxx#bb.html', fragment='')

>>> parse.urlunsplit(a)
'http://www.xyz.com/aa.html;aoteman?param=xxx#bb.html'
```



#### 5ã€urljoin

urlæ‹¼æ¥ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœbaseåœ°å€å€å¹¶éä»¥å­—ç¬¦/ç»“å°¾çš„è¯ï¼Œé‚£ä¹ˆURLåŸºåœ°å€æœ€å³è¾¹éƒ¨åˆ†å°±ä¼šè¢«è¿™ä¸ªç›¸å¯¹è·¯å¾„æ‰€æ›¿æ¢ã€‚å¦‚æœå¸Œæœ›åœ¨è¯¥è·¯å¾„ä¸­ä¿ç•™æœ«ç«¯ç›®å½•ï¼Œåº”ç¡®ä¿URLåŸºåœ°å€ä»¥å­—ç¬¦/ç»“å°¾ã€‚

```python
>>> import urlparse
>>> urlparse.urljoin('http://www.oschina.com/tieba','index.php')
'http://www.oschina.com/index.php'			# tiebaæ²¡äº†

>>> urlparse.urljoin('http://www.oschina.com/tieba/','index.php')
'http://www.oschina.com/tieba/index.php'	#tiebah
```

