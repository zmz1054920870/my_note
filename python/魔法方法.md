## ä¸€ã€	`__dict__`

**æ³¨è§£ï¼šå®ä¾‹å±æ€§**



#### 1.1	ç±»å±æ€§

**æ³¨è§£ï¼šç±»å±æ€§å¯ä»¥åœ¨MetaClassçš„`__init__`ä¸­å®šä¹‰ï¼Œä¹Ÿå¯ä»¥åœ¨æ„å»ºç±»çš„æ—¶å€™å®šä¹‰**

```python
print(Person.__dict__)
{'__module__': '__main__', '__annotations__': {'name': <class 'str'>}, '__doc__': '\n    å¤šè¡Œæ³¨é‡Š\n    ', 'gender': 'man', 'name': 'å¼ ä¸‰', '__new__': <staticmethod object at 0x00000222E69F37B8>, '__init__': <function Person.__init__ at 0x00000222E69DA620>, '__call__': <function Person.__call__ at 0x00000222E69DA6A8>, 'say': <function Person.say at 0x00000222E69DA730>, 'tell': <staticmethod object at 0x00000222E69F3710>, 'id': 11111111111111111111, 'my_test': <function my_test at 0x00000222E69DA1E0>, '__dict__': <attribute '__dict__' of 'Person' objects>, '__weakref__': <attribute '__weakref__' of 'Person' objects>, 'hh': 100}
```



#### 1.2	å®ä¾‹å±æ€§

```python
cl = Person('perter', age=18)
print(cl.__dict__)
{'name': 'PERTER', 'age': 18}
```



## äºŒã€å±æ€§æ–¹æ³•

| é­”æ³•æ–¹æ³•           | å«ä¹‰                                       |
| ------------------ | ------------------------------------------ |
| `__getattr__`      | `å®šä¹‰ç”¨æˆ·è¯•å›¾è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„å±æ€§æ—¶çš„è¡Œä¸º` |
| `__getattribute__` | `å®šä¹‰å½“è¯¥ç±»çš„å±æ€§è¢«è®¿é—®æ—¶çš„è¡Œä¸º`           |
| `__setattr__`      | `å®šä¹‰å½“ä¸€ä¸ªå±æ€§è¢«è®¾ç½®æ—¶çš„è¡Œä¸º`             |
| `__delattr__`      | `å®šä¹‰å½“ä¸€ä¸ªå±æ€§è¢«åˆ é™¤æ—¶çš„è¡Œä¸º`             |

`__setattr__`  åªæœ‰`self.name=value`è¿™ç§ç»™å¯¹è±¡æ·»åŠ å±æ€§çš„æ–¹å¼æ‰ä¼šè¢«è°ƒç”¨

`__getattr__å’Œ__getattribute__`åªæœ‰`self.name`è¿™ç§ç»™å¯¹è±¡æ·»åŠ å±æ€§çš„æ–¹å¼æ‰ä¼šè¢«è°ƒç”¨ï¼Œè¿˜æœ‰ä¸€ç‚¹ï¼Œhasattr(object, value)ä¹Ÿä¼šè°ƒç”¨



```python
class Behavior(object):
    a = 111111111111111111111111111111111111111111111
    __instance = None

    def __new__(cls, *args, **kwargs):
        if cls.__instance is None:
            cls.__instance = super(Behavior, cls).__new__(cls)
        return cls.__instance

    def __init__(self, name, age):
        self.name = name
        self.age = age

    def __getattribute__(self, item):
        print('__getattribute__')
        return super(Behavior, self).__getattribute__(item)

    def __getattr__(self, item):
        print('__getattr__', item)
        return super(Behavior, self).__getattr__(item)

    def func(self):
        print('func')
        
if __name__ == '__main__':					
    a = Behavior('å¼ ä¸‰', 31)
    print('Behavior:', Behavior.a)			# è¿™ä¸ªä¸ä¼šè°ƒç”¨__getattribute__, å› ä¸ºé‡‡ç”¨çš„æ˜¯cls.nameçš„æ–¹å¼è°ƒç”¨ç±»å±æ€§
    
    
    print(getattr(a, 'a', 'æœ¨æœ‰'))		   # è¿™ä¸ªä¼šè°ƒç”¨__getattribute___, å› ä¸ºé‡‡ç”¨çš„æ˜¯self.nameçš„æ–¹å¼è°ƒç”¨ç±»å±æ€§	
    
    
    print(hasattr(a, 'xx'))					# è¿™ä¸ªä¼šè°ƒç”¨__getattribute___, å› ä¸ºé‡‡ç”¨çš„æ˜¯self.nameçš„æ–¹å¼è°ƒç”¨ç±»å±æ€§
```

**å¤‡æ³¨ï¼šå…¶å®ä»–ä»¬éƒ½æ˜¯æ‹¿å–çš„`Behavior.__dict__` å’Œ `self.__dict__`ä¸­çš„å±æ€§.. è¿™è¦å‰é¢æ˜¯selfåŠ ç‚¹çš„å½¢å¼éƒ½ä¼šè°ƒç”¨ä¸Šé¢å››ç§é­”æ³•æ–¹æ³•**





#### 2.1	æ­»å¾ªç¯ä¾‹å­

```python
class Rectangle():
	def __init__(self, width=0, height=0):
		self.width = width
		self.height = height
	
    def __setattr__(self, name, value):
        if name = 'square':
            self.width = value
            self.height = value
        else:
            self.name = value
            
r = Rectangle(4, 5)
# æŠ¥é”™ï¼š æ— é™é€’å½’
```

**åˆ†æï¼šå®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™è°ƒç”¨`__init__`æ–¹æ³•ï¼Œ åœ¨è¿™é‡Œç»™`self.width`å’Œ`self.height`èµ‹å€¼ã€‚ä¸€å‘ç”Ÿèµ‹å€¼æ“ä½œï¼Œå°±ä¼šè§¦å‘`__setattr__`é­”æ³•æ–¹æ³•ï¼Œäºæ˜¯æ‰§è¡Œelseé‡Œé¢çš„`self.name`åˆè§¦å‘äº†é­”æ³•æ–¹æ³•`__setattr__`,å°±æ— çº¿å¾ªç¯äº†**

**è§£å†³æ–¹æ³•ï¼šä½¿ç”¨`super()`æˆ–è€…`self.__dict__['name']=value`,çµæ´»åº”ç”¨**



#### 2.2	å®ä¾‹

```python
class WebSite(object):
    """
    title: class
    """
    number_to_people = 0    # ç­çº§äººæ•°

    def __new__(cls, *args, **kwargs):
        cls.number_to_people = 100
        return super(WebSite, cls).__new__(cls)

    def __init__(self, name: str, age: int) -> None:
        self.name = name
        self.age = age

    def __getattr__(self, item):
        print('__getattr__')
        raise AttributeError

    def __getattribute__(self, item):
        print('__getattribute__')
        return super(WebSite, self).__getattribute__(item)

    def __setattr__(self, key, value):
        print('__setattr__')
        super().__setattr__(key, value)

    def __delattr__(self, item):
        print('__delattr__')
        super().__delattr__(item)

    def func(self):
        print(self.name)


if __name__ == '__main__':
    a = WebSite('å¼ ä¸‰', 20)
    a.title = 'wangbadang'
    print(a.title)
    print(a.__dict__)
    WebSite.xxx = '123123'
    # a.yyy = '2222222'
    print(a.yyy)
    
   
```





## ä¸‰ã€ä¸å®¹å™¨ç›¸å…³çš„é­”æ³•æ–¹æ³•



| é­”æ³•æ–¹æ³•      | å«ä¹‰                                                         |
| ------------- | ------------------------------------------------------------ |
| `__len__`     | `å®šä¹‰å½“è¢«len()å‡½æ•°è°ƒç”¨æ—¶å€™çš„è¡Œä¸ºï¼Œè¿”å›å®¹å™¨å…ƒç´ ä¸ªæ•°`          |
| `__getitem__` | `å®šä¹‰è·å–æŒ‡å®šå…ƒç´ çš„è¡Œä¸ºï¼Œç›¸å½“äºself[key] and self[1]`        |
| `__setitem__` | `å®šä¹‰è®¾ç½®å®¹å™¨ä¸­æŒ‡å®šå…ƒç´ çš„è¡Œä¸ºï¼Œç›¸å½“äºself[key]=value and self[1] = 2` |
| `__delitem__` | `å®šä¹‰åˆ é™¤å®¹å™¨ä¸­æŒ‡å®šå…ƒç´ çš„è¡Œä¸ºï¼Œç›¸å½“äºdel self[key]`          |



**æ³¨è§£ï¼š`object`åªæœ‰`__getitem__`**

æºç å¦‚ä¸‹ï¼š

```python
def __getitem__(self, *args, **kwargs): # real signature unknown
    """ Return self[key]. """
    pass
```



```python
class NAME(object):

    def __init__(self, name: list, age):
        self.name = name
        self.age = age

    def __getitem__(self, item):
        return self.name[item]

    def __setitem__(self, key, value):
        self.name[key] = value

    def pop(self):
        data = self.name.pop()
        return data

    def append(self, name):
        self.name.append(name)

    def __str__(self):
        print(11111111111)
        return str(self.name)
    
a = NAME([1, 2, 3], 28)
print(a[1])
a.append(2)
print(a)


2
11111111111
[1, 2, 3, 2]

```





## å››ã€`setattr`ã€`getattr`ã€`hasattr`

**æ³¨è§£ï¼šè¿™ä¸å…‰å¯ä»¥æ“ä½œç±»ï¼Œå®ä¾‹ï¼Œè¿˜å¯ä»¥æ“ä½œå‡½æ•°**

```python
class CustomContains(object):
    """
    haha
    """

    def __init__(self, num_one, num_two):
        self.structure = [num_one, num_two]
        self.count = {}.fromkeys(range(len(self.structure)), 0)

    def __iter__(self):
        return self

    def __next__(self):
        pass

    def __getitem__(self, item):
        print('__getitem__')

    def __setitem__(self, key, value):
        print('__setitem__')

    def func(self, name):
        b = name
        print(b)
        print(self.structure)


if __name__ == '__main__':
    # a = object.__dict__
    a = CustomContains(1, 2)
    d = getattr(a, 'func')                  # è·å–å®ä¾‹å±æ€§
    d(1)
    setattr(CustomContains, 'name', 'å¼ ä¸‰')   # æ·»åŠ ç±»å±æ€§
    setattr
    print(getattr(a, '__doc__'))
```



**ğŸ”ºæ“ä½œå‡½æ•°çš„ä¾‹å­**

```python
def func(num):
    print(num)


def hook_func(num):
    print(num)


setattr(func, 'hook_func', hook_func)
func(111)
func.hook_func(222)

111
222
```

