https://www.cnblogs.com/yxh168/p/9058043.html

# ä¸€ã€[CAè¯ä¹¦å’ŒSSL/TLSä»‹ç»åŠå…¬é’¥ç§é’¥åŠ å¯†](https://www.cnblogs.com/yxh168/p/9058043.html)

**å‰è¨€ï¼šå…¬é’¥åŠ å¯†ï¼Œç§é’¥èƒ½è§£ï¼›ç§é’¥åŠ å¯†ã€å…¬é’¥èƒ½è§£**





## 1.1 æ•°å­—ç­¾å

  ğŸ”ºç”¨è‡ªå·±çš„ç§é’¥ç»™æ•°æ®åŠ å¯†å°±å«æ•°å­—ç­¾å

## 1.2 å…¬é’¥ä¼ è¾“å¨èƒ

  åœ¨Aå’ŒBçš„é€šä¿¡ä¸­,Cå¯ä»¥æŠŠè‡ªå·±çš„å…¬é’¥å‘ç»™A,è®©AæŠŠCçš„å…¬é’¥å½“æˆBçš„å…¬é’¥,è¿™æ ·çš„è¯.Bæ‹¿åˆ°åŠ å¯†æ•°æ®åè€Œæ— æ³•è§£å¯†,è€ŒCå´å¯ä»¥è§£å¯†å‡ºæ•°æ®.ä»è€Œå®ç°Cæˆªè·ABä¹‹é—´çš„æ•°æ®

  æ‰€ä»¥åœ¨ä¸¤è€…çš„é€šä¿¡ä¸­å¿…é¡»è¦å¯¹å…¬é’¥çš„æ¥æºè¿›è¡Œç¡®è®¤

![img](198738-20180518195245843-1737193698.png)

 Aå’ŒBå¦‚æœæƒ³å®‰å…¨äº¤æ¢å…¬é’¥,å°±å¿…é¡»é€šè¿‡CA(è¯ä¹¦é¢å‘æœºæ„) è¯ä¹¦çš„é€šä¿¡è¿‡ç¨‹    Aå’ŒBé¦–å…ˆéƒ½å†…ç½®äº†CAçš„å…¬é’¥

 æ ¹,CAçš„è¯ä¹¦æ˜¯è‡ªå·±ç»™è‡ªå·±ç­¾åçš„(è‡ªç­¾å)

 ![img](198738-20180518200806498-1908414788.png)

 

## 1.3 CAå’Œè¯ä¹¦ 

 PKI: Public Key Infrastructure 

â€‹    ç­¾è¯æœºæ„ï¼šCAï¼ˆCertificate Authorityï¼‰ 

â€‹    æ³¨å†Œæœºæ„ï¼šRA 

â€‹    è¯ä¹¦åŠé”€åˆ—è¡¨ï¼šCRL 

â€‹    è¯ä¹¦å­˜å–åº“ï¼š X.509ï¼šå®šä¹‰äº†è¯ä¹¦çš„ç»“æ„ä»¥åŠè®¤è¯åè®®æ ‡å‡† 

â€‹                ç‰ˆæœ¬å·  åºåˆ—å·  ç­¾åç®—æ³•  é¢å‘è€…  æœ‰æ•ˆæœŸé™  ä¸»ä½“åç§°  ä¸»ä½“å…¬é’¥  CRLåˆ†å‘ç‚¹   æ‰©å±•ä¿¡æ¯  å‘è¡Œè€…ç­¾å 



```
CAæœºæ„å±äºä¸€ä¸ªä¸»ä½“ï¼Œæ¯”å¦‚ï¼šGworg CAæœºæ„ï¼Œç„¶è€ŒCAæœºæ„å¯ä»¥é¢å‘å„ç§æ•°å­—è¯ä¹¦ï¼Œå…¶ä¸­åŒ…æ‹¬SSLè¯ä¹¦ã€é‚®ä»¶è¯ä¹¦ã€åŠ å¯†è¯ä¹¦ã€è½¯ä»¶æ•°å­—è¯ä¹¦ç­‰ç­‰ã€‚
è§£é‡ŠåŸå› ï¼š

CAè¯ä¹¦ï¼Œæ˜¯æŒ‡CAé¢å‘æœºæ„ï¼Œé¢å‘çš„æ•°å­—è¯ä¹¦ã€‚
CAæœºæ„ä¸»è¦ä¸šåŠ¡æ˜¯é¢å‘æ•°å­—è¯ä¹¦ã€‚

SSLè¯ä¹¦å±äºæ•°å­—è¯ä¹¦çš„ä¸€ç§ï¼Œç”¨äºHTTPSåŠ å¯†åè®®ã€‚

è§£å†³åŠæ³•ï¼šGworg CAæœºæ„è·å¾—SSLè¯ä¹¦ã€‚


è¯ä¹¦ç®¡ç†æœºæ„CAï¼ŒCAæ˜¯PKIç³»ç»Ÿä¸­é€šä¿¡åŒæ–¹éƒ½ä¿¡ä»»çš„å®ä½“ï¼Œè¢«ç§°ä¸ºå¯ä¿¡ç¬¬ä¸‰æ–¹ï¼ˆTrusted Third Partyï¼Œç®€ç§°TTPï¼‰ã€‚CAä½œä¸ºå¯ä¿¡ç¬¬ä¸‰æ–¹çš„é‡è¦æ¡ä»¶ä¹‹ä¸€å°±æ˜¯CAçš„è¡Œä¸ºå…·æœ‰éå¦è®¤æ€§ã€‚CAé€šè¿‡è¯ä¹¦è¯å®ä»–äººçš„å…¬é’¥ä¿¡æ¯ï¼Œè¯ä¹¦ä¸Šæœ‰CAçš„ç­¾åã€‚ç”¨æˆ·å¦‚æœå› ä¸ºä¿¡ä»»è¯ä¹¦è€Œå¯¼è‡´äº†æŸå¤±ï¼Œè¯ä¹¦å¯ä»¥ä½œä¸ºæœ‰æ•ˆçš„è¯æ®ç”¨äºè¿½ç©¶CAçš„æ³•å¾‹è´£ä»»ã€‚æ­£æ˜¯å› ä¸ºCA æ„¿æ„ç»™å‡ºæ‰¿æ‹…è´£ä»»çš„æ‰¿è¯ºï¼Œæ‰€ä»¥ä¹Ÿè¢«ç§°ä¸ºå¯ä¿¡ç¬¬ä¸‰æ–¹ã€‚
CAæ•°å­—è¯ä¹¦ç”±CAç­¾å‘å’Œç®¡ç†ï¼Œèƒ½æä¾›åœ¨Internetä¸Šè¿›è¡Œèº«ä»½éªŒè¯çš„ä¸€ç§æƒå¨æ€§ç”µå­æ–‡æ¡£ï¼Œäººä»¬å¯ä»¥åœ¨äº’è”ç½‘äº¤å¾€ä¸­ç”¨å®ƒæ¥è¯æ˜è‡ªå·±çš„èº«ä»½å’Œè¯†åˆ«å¯¹æ–¹çš„èº«ä»½ã€‚ç±»ä¼¼äºç°å®ä¸–ç•Œçš„èº«ä»½è¯
```



## 1.4 SSL

 SSLæ˜¯Netscapeå¼€å‘çš„ä¸“é—¨ç”¨äºä¿æŠ¤Webé€šè®¯çš„ï¼Œç›®å‰ç‰ˆæœ¬ä¸º3.0ã€‚æœ€æ–°ç‰ˆæœ¬çš„TLS 1.0æ˜¯IETF(å·¥ç¨‹ä»»åŠ¡ç»„)åˆ¶å®šçš„ä¸€ç§æ–°çš„åè®®ï¼Œå®ƒå»ºç«‹åœ¨SSL 3.0åè®®è§„èŒƒä¹‹ä¸Šï¼Œæ˜¯SSL 3.0çš„åç»­ç‰ˆæœ¬ã€‚ä¸¤è€…å·®åˆ«æå°ï¼Œå¯ä»¥ç†è§£ä¸ºSSL 3.1ï¼Œå®ƒæ˜¯å†™å…¥äº†RFCçš„ã€‚SSLå®‰å…¨å¥—æ¥å­—å’ŒSSLè¯ä¹¦ä¸ä¸€æ ·çš„ã€‚SSLæ˜¯åˆ«äººå¼€å‘çš„åè®®ï¼ŒSSLè¯ä¹¦æ˜¯CAæœºæ„é¢å‘çš„ï¼Œæ”¶è´¹çš„ã€‚ã€‚



 æ‰€ä»¥ï¼ŒSSL(Secure  Socket  Layer)å’ŒTLS(Transport  Layer Security )æœ¬èº«æ˜¯ä¸€ä¸ªä¸œè¥¿

  å®ç°åŠŸèƒ½: æœºå¯†æ€§   è®¤è¯  å®Œæ•´æ€§   é‡æ”¾ä¿æŠ¤(æ­£ç¡®åŒæ ·çš„æ•°æ®ä¸èƒ½é‡å¤å‘é€)

  ä¸¤é˜¶æ®µåè®®ï¼Œåˆ†ä¸ºæ¡æ‰‹é˜¶æ®µå’Œåº”ç”¨é˜¶æ®µ 

  æ¡æ‰‹é˜¶æ®µ(åå•†é˜¶æ®µ):

â€‹      å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯è®¤è¯å¯¹æ–¹èº«ä»½ï¼ˆä¾èµ–äºPKIä½“ç³»ï¼Œåˆ©ç”¨æ•°å­—è¯ä¹¦è¿›è¡Œ èº«ä»½è®¤è¯ï¼‰,å¹¶åå•†é€šä¿¡ä¸­ä½¿ç”¨çš„å®‰å…¨å‚æ•°ã€å¯†ç å¥—ä»¶ä»¥åŠä¸»å¯†é’¥.

â€‹      åç»­é€šä¿¡ä½¿ç”¨çš„æ‰€æœ‰å¯†é’¥éƒ½æ˜¯ é€šè¿‡MasterSecretç”Ÿæˆã€‚ 

   åº”ç”¨é˜¶æ®µ:

â€‹      åœ¨æ¡æ‰‹é˜¶æ®µå®Œæˆåè¿›å…¥,åœ¨åº”ç”¨é˜¶æ®µé€šä¿¡åŒæ–¹ä½¿ç”¨æ¡æ‰‹é˜¶æ®µåå•†å¥½çš„å¯†é’¥è¿›è¡Œå®‰å…¨é€šä¿¡ 

  taobao è¯ä¹¦  httpsçš„é€šä¿¡è¿‡ç¨‹

  taobao è¯ä¹¦å†…å®¹åŒ…å« SCA(Ptaobao) å¯†é’¥åŠ å¯†ç­¾åè¿‡çš„taobaoå…¬é’¥ + CAè¯ä¹¦æè¿°+è¿‡æœŸæ—¶é—´+è¯ä¹¦å…¶å®ƒä¿¡æ¯ taobaoç½‘ç«™æŠŠè¯ä¹¦å‘ç»™å®¢æˆ·ç«¯

  å®¢æˆ·ç«¯ç”±äºä¿¡ä»»CAå¹¶ä¸”æ‹¿åˆ°äº†CAçš„å…¬é’¥,å°±å¯ä»¥è§£å¯†SCA(Ptaobao) è·å¾—taobaoçš„å…¬é’¥ Ptaobao

  å®¢æˆ·ç«¯(æµè§ˆå™¨)ä¼šåœ¨æœ¬åœ°ç”Ÿæˆä¸€ä¸ªå¯¹ç§°å¯†é’¥(key)ç”¨taobaoçš„å…¬é’¥åŠ å¯†å‘é€ç»™taobao Ptaobao(key)  sendto taobao

  taobaoé€šè¿‡è‡ªå·±çš„ç§é’¥è§£å¯†å¾—åˆ°å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„key  Staobao(Ptaobao(key)) = key è¿™æ ·åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å­˜åœ¨ç›¸åŒçš„å¯¹ç§°å¯†é’¥key

  å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å°±å¯ä»¥é€šè¿‡key(data)å¯¹å¤§é‡çš„ç½‘é¡µæ•°æ®è¿›è¡Œå¯¹ç§°åŠ å¯†,å®ç°é€šä¿¡åŒæ–¹çš„å®‰å…¨é€šä¿¡

 

## 1.5 OpenSSL å¼€æºå®ç°è¯ä¹¦ç”³è¯·å’Œé¢å‘

  base64ç¼–ç    æ˜¯6bitç¼–ç     åŒ…å«å­—ç¬¦a-z,A-Z,/,+ æ€»å…±64ä¸ªç¬¦å·

  ç”Ÿæˆç§é’¥ 

â€‹    openssl genrsa -out /PATH/TO/PRIVATEKEY.FILE NUM_BITS  (umask 077; openssl genrsa â€“out test.key â€“des 2048)  -desè¡¨ç¤ºå¯¹å¯†é’¥å¯¹ç§°ç§°åŠ å¯†

â€‹    openssl rsa -in test.key â€“out test2.key     å°†åŠ å¯†keyè§£å¯†

  ä»ç§é’¥ä¸­æå–å‡ºå…¬é’¥ 

â€‹    openssl rsa -in PRIVATEKEYFILE â€“pubout â€“out PUBLICKEYFILE openssl rsa â€“in test.key â€“pubout â€“out test.key.pub 

 

## 1.6 å®éªŒ:å‘CAç”³è¯·è¯ä¹¦

###### å»ºç«‹Root CA

  \1. åˆ›å»ºCAé‡è¦çš„é…ç½®æ–‡ä»¶opensslçš„é…ç½®æ–‡ä»¶ï¼š/etc/pki/tls/openssl.cnf 

  \2. é»˜è®¤CAçš„å·¥ä½œç›®å½•åœ¨   /etc/pki/CA 

![img](https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif) åˆ›å»ºCAæœåŠ¡å™¨

###### ç”¨æˆ·æˆ–è€…æœåŠ¡å™¨ç”³è¯·è¯ä¹¦

![img](https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif) CAç­¾å‘è¯ä¹¦(å®¢æˆ·ç«¯)

 

###### windowsä¸‹æŸ¥çœ‹ç”Ÿæˆçš„è¯ä¹¦ä¿¡æ¯å’Œå®‰è£…è¯ä¹¦

å¯ä»¥æŠŠè¯ä¹¦cacert.pemä¸‹è½½åˆ°windowsä¸­è¿›è¡Œå¯è§†åŒ–æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯
éœ€è¦.pem(cacert.pem)åç¼€åæ”¹æˆwindowsèƒ½è¯†åˆ«çš„.cer(cacert.cer)æˆ–è€….crt   ç‚¹å‡»å®‰è£…è¯ä¹¦å¯ä»¥æŠŠæ­¤è¯ä¹¦å®‰è£…åˆ°å¯ä¿¡ä»»çš„è¯ä¹¦è·¯å¾„ä¸­

![img](198738-20180519100004680-1218950636.png)

 

##   1.7 è¯ä¹¦ç®¡ç†

   æŸ¥çœ‹è¯ä¹¦ä¸­çš„ä¿¡æ¯ï¼š 

   openssl x509 -in /PATH/FROM/CERT_FILE -noout   -text|issuer|subject|serial|dates 

   openssl ca -status SERIAL  æŸ¥çœ‹æŒ‡å®šç¼–å·çš„è¯ä¹¦çŠ¶æ€ 

  åŠé”€è¯ä¹¦ 

â€‹    åœ¨å®¢æˆ·ç«¯è·å–è¦åŠé”€çš„è¯ä¹¦çš„serial 

â€‹       openssl x509 -in /PATH/FROM/CERT_FILE -noout -serial -subject 

â€‹    åœ¨CAä¸Š,æ ¹æ®å®¢æˆ·æäº¤çš„serialä¸subjectä¿¡æ¯,å¯¹æ¯”æ£€éªŒæ˜¯å¦ä¸index.txtæ–‡ä»¶ä¸­çš„ä¿¡æ¯ä¸€è‡´,åŠ é”€è¯ä¹¦ï¼š 

â€‹      openssl ca -revoke /etc/pki/CA/newcerts/SERIAL.pem 

   æŒ‡å®šç¬¬ä¸€ä¸ªåŠé”€è¯ä¹¦çš„ç¼–å·,æ³¨æ„:ç¬¬ä¸€æ¬¡æ›´æ–°è¯ä¹¦åŠé”€åˆ—è¡¨å‰,æ‰éœ€è¦æ‰§è¡Œ echo 01 > /etc/pki/CA/crlnumber 

   æ›´æ–°è¯ä¹¦åŠé”€åˆ—è¡¨ openssl ca -gencrl -out /etc/pki/CA/crl.pem 

   æŸ¥çœ‹crlæ–‡ä»¶ï¼š openssl crl -in /etc/pki/CA/crl.pem -noout -text 

 

## 1.8 SSHå®‰å…¨æœåŠ¡  

  ssh: secure shell, protocol, 22/tcp, å®‰å…¨çš„è¿œç¨‹ç™»å½•

  ä¸¤ç§æ–¹å¼çš„ç”¨æˆ·ç™»å½•è®¤è¯ï¼š 

   1.åŸºäºpassword 

â€‹       1.å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€SSHè¯·æ±‚

â€‹       2.æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚,å‘é€å…¬é’¥ç»™å®¢æˆ·ç«¯

â€‹       3.å®¢æˆ·ç«¯è¾“å…¥ç”¨æˆ·åå’Œå¯†ç é€šè¿‡å…¬é’¥åŠ å¯†å›ä¼ ç»™æœåŠ¡ç«¯

â€‹       4.æœåŠ¡ç«¯é€šè¿‡ç§é’¥è§£å¯†å¾—åˆ°ç”¨æˆ·åå’Œå¯†ç å’Œæœ¬åœ°çš„ç”¨æˆ·åå¯†ç è¿›è¡ŒéªŒè¯åŒ¹é…

 

   2.åŸºäºkey

â€‹       1.é¦–å…ˆåœ¨å®¢æˆ·ç«¯ç”Ÿæˆä¸€å¯¹å¯†é’¥å¯¹

â€‹       2.å®¢æˆ·ç«¯å°†å…¬é’¥æ‹·è´ç»™æœåŠ¡ç«¯å¹¶é‡å‘½åä¸º authorized_keys

â€‹       3.å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªè¿æ¥è¯·æ±‚,ä¿¡æ¯åŒ…æ‹¬ip,ç”¨æˆ·å

â€‹       4.æœåŠ¡ç«¯å¾—åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯å,ä¼šåˆ°authorized_keysæŸ¥æ‰¾æ˜¯å¦æœ‰å¯¹åº”ä¿¡æ¯å¹¶ä¸”éšæœºç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²

â€‹       5.æœåŠ¡ç«¯æŠŠéšæœºç”Ÿæˆçš„å­—ç¬¦ä¸²ç”¨å®¢æˆ·ç«¯å…¬é’¥åŠ å¯†å‘é€ç»™å®¢æˆ·ç«¯

â€‹       6.å®¢æˆ·ç«¯æ¥æ”¶åˆ°åŠ å¯†å­—ç¬¦ä¸²åç”¨è‡ªå·±çš„ç§é’¥å¯¹å­—ç¬¦ä¸²è¿›è¡Œè§£å¯†,å¹¶ä¸”æŠŠè§£å¯†åçš„å­—ç¬¦ä¸²å‘é€ç»™æœåŠ¡ç«¯

â€‹       7.æœåŠ¡ç«¯ä¼šæŠŠæ¥æ”¶åˆ°çš„å­—ç¬¦ä¸²å’ŒåŸæ¥è‡ªå·±ç”Ÿæˆçš„éšæœºå­—ç¬¦ä¸²è¿›è¡ŒéªŒè¯åŒ¹é…

 sshå®¢æˆ·ç«¯ï¼š

   1.å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ /etc/ssh/ssh_config       sshæœåŠ¡ç«¯çš„é…ç½®æ–‡ä»¶  /etc/ssh/sshd_config

   sshå®¢æˆ·ç«¯ä¼šåœ¨ç¬¬ä¸€æ¬¡è¿æ¥çš„æ—¶å€™æŠŠè¿œç¨‹ä¸»æœºçš„å…¬é’¥ä¸‹è½½åˆ°æœ¬æœº,å¦‚æœéœ€è¦å†’å……å…¶å®ƒå·²ç»è¿æ¥è¿‡çš„ä¸»æœº,éœ€è¦æŠŠå¯¹æ–¹çš„ç§é’¥æ‹·è´åˆ°æœ¬åœ°æ¥

 

## 1.9 å®ç°åŸºäºssh keyçš„è®¤è¯

  å®ç°æŒ‡å®šç”¨æˆ·æ— å¯†ç è¿æ¥,é»˜è®¤æ˜¯rootç”¨æˆ· åœ¨ssh-copy-idå‘½ä»¤ä¸­æŒ‡å®šç‰¹å®šçš„ç”¨æˆ·åå°±ä¼šæŠŠå…¬é’¥æ–‡ä»¶æ‹·è´åˆ°æŒ‡å®šç”¨æˆ·çš„å®¶ç›®å½•ä¸‹

  ssh-copy-id  yxh@192.168.33.130

![img](https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif) View Code

 

å¤šå°ä¸»æœºä¹‹é—´å®ç°ç›¸äº’keyè®¤è¯ç™»å½•

   1.åœ¨ä¸€å°ä¸»æœºAä¸Šç”Ÿæˆä¸€å¯¹å¯†é’¥å¯¹æ‰€æœ‰ä¸»æœºä½¿ç”¨åŒä¸€å¯†é’¥

   2.ssh-copy-id A

  *3.scp  -rp   /root/.ssh B:/root*

  **4.scp  -rp   /root/.ssh C:/root**

 

## 1.10 ssh keyè®¤è¯è„šæœ¬è‡ªåŠ¨åŒ–

 expectåŒ¹é…è¾“å‡ºè§„åˆ™ï¼š

   \#Are you sure you want to continue connecting (yes/no)?
   \#root@192.168.33.129's password:





## äºŒã€`å…¬é’¥å’Œç§é’¥åŠ è§£å¯†`

```
1.

é²å‹ƒæœ‰ä¸¤æŠŠé’¥åŒ™ï¼Œä¸€æŠŠæ˜¯å…¬é’¥ï¼Œå¦ä¸€æŠŠæ˜¯ç§é’¥ã€‚

2.
é²å‹ƒæŠŠå…¬é’¥é€ç»™ä»–çš„æœ‹å‹ä»¬----å¸•è’‚ã€é“æ ¼ã€è‹çŠ----æ¯äººä¸€æŠŠã€‚

3.

è‹çŠè¦ç»™é²å‹ƒå†™ä¸€å°ä¿å¯†çš„ä¿¡ã€‚å¥¹å†™å®Œåç”¨é²å‹ƒçš„å…¬é’¥åŠ å¯†ï¼Œå°±å¯ä»¥è¾¾åˆ°ä¿å¯†çš„æ•ˆæœã€‚

4.

é²å‹ƒæ”¶ä¿¡åï¼Œç”¨ç§é’¥è§£å¯†ï¼Œå°±çœ‹åˆ°äº†ä¿¡ä»¶å†…å®¹ã€‚è¿™é‡Œè¦å¼ºè°ƒçš„æ˜¯ï¼Œåªè¦é²å‹ƒçš„ç§é’¥ä¸æ³„éœ²ï¼Œè¿™å°ä¿¡å°±æ˜¯å®‰å…¨çš„ï¼Œå³ä½¿è½åœ¨åˆ«äººæ‰‹é‡Œï¼Œä¹Ÿæ— æ³•è§£å¯†ã€‚

5.

é²å‹ƒç»™è‹çŠå›ä¿¡ï¼Œå†³å®šé‡‡ç”¨"æ•°å­—ç­¾å"ã€‚ä»–å†™å®Œåå…ˆç”¨Hashå‡½æ•°ï¼Œç”Ÿæˆä¿¡ä»¶çš„æ‘˜è¦ï¼ˆdigestï¼‰ã€‚

6.

ç„¶åï¼Œé²å‹ƒä½¿ç”¨ç§é’¥ï¼Œå¯¹è¿™ä¸ªæ‘˜è¦åŠ å¯†ï¼Œç”Ÿæˆ"æ•°å­—ç­¾å"ï¼ˆsignatureï¼‰ã€‚

7.

é²å‹ƒå°†è¿™ä¸ªç­¾åï¼Œé™„åœ¨ä¿¡ä»¶ä¸‹é¢ï¼Œä¸€èµ·å‘ç»™è‹çŠã€‚

8.

è‹çŠæ”¶ä¿¡åï¼Œå–ä¸‹æ•°å­—ç­¾åï¼Œç”¨é²å‹ƒçš„å…¬é’¥è§£å¯†ï¼Œå¾—åˆ°ä¿¡ä»¶çš„æ‘˜è¦ã€‚ç”±æ­¤è¯æ˜ï¼Œè¿™å°ä¿¡ç¡®å®æ˜¯é²å‹ƒå‘å‡ºçš„ã€‚

9.

è‹çŠå†å¯¹ä¿¡ä»¶æœ¬èº«ä½¿ç”¨Hashå‡½æ•°ï¼Œå°†å¾—åˆ°çš„ç»“æœï¼Œä¸ä¸Šä¸€æ­¥å¾—åˆ°çš„æ‘˜è¦è¿›è¡Œå¯¹æ¯”ã€‚å¦‚æœä¸¤è€…ä¸€è‡´ï¼Œå°±è¯æ˜è¿™å°ä¿¡æœªè¢«ä¿®æ”¹è¿‡ã€‚

10.

å¤æ‚çš„æƒ…å†µå‡ºç°äº†ã€‚é“æ ¼æƒ³æ¬ºéª—è‹çŠï¼Œä»–å·å·ä½¿ç”¨äº†è‹çŠçš„ç”µè„‘ï¼Œç”¨è‡ªå·±çš„å…¬é’¥æ¢èµ°äº†é²å‹ƒçš„å…¬é’¥ã€‚æ­¤æ—¶ï¼Œè‹çŠå®é™…æ‹¥æœ‰çš„æ˜¯é“æ ¼çš„å…¬é’¥ï¼Œä½†æ˜¯è¿˜ä»¥ä¸ºè¿™æ˜¯é²å‹ƒçš„å…¬é’¥ã€‚å› æ­¤ï¼Œé“æ ¼å°±å¯ä»¥å†’å……é²å‹ƒï¼Œç”¨è‡ªå·±çš„ç§é’¥åšæˆ"æ•°å­—ç­¾å"ï¼Œå†™ä¿¡ç»™è‹çŠï¼Œè®©è‹çŠç”¨å‡çš„é²å‹ƒå…¬é’¥è¿›è¡Œè§£å¯†ã€‚

11.

åæ¥ï¼Œè‹çŠæ„Ÿè§‰ä¸å¯¹åŠ²ï¼Œå‘ç°è‡ªå·±æ— æ³•ç¡®å®šå…¬é’¥æ˜¯å¦çœŸçš„å±äºé²å‹ƒã€‚å¥¹æƒ³åˆ°äº†ä¸€ä¸ªåŠæ³•ï¼Œè¦æ±‚é²å‹ƒå»æ‰¾"è¯ä¹¦ä¸­å¿ƒ"ï¼ˆcertificate authorityï¼Œç®€ç§°CAï¼‰ï¼Œä¸ºå…¬é’¥åšè®¤è¯ã€‚è¯ä¹¦ä¸­å¿ƒç”¨è‡ªå·±çš„ç§é’¥ï¼Œå¯¹é²å‹ƒçš„å…¬é’¥å’Œä¸€äº›ç›¸å…³ä¿¡æ¯ä¸€èµ·åŠ å¯†ï¼Œç”Ÿæˆ"æ•°å­—è¯ä¹¦"ï¼ˆDigital Certificateï¼‰ã€‚

12.

é²å‹ƒæ‹¿åˆ°æ•°å­—è¯ä¹¦ä»¥åï¼Œå°±å¯ä»¥æ”¾å¿ƒäº†ã€‚ä»¥åå†ç»™è‹çŠå†™ä¿¡ï¼Œåªè¦åœ¨ç­¾åçš„åŒæ—¶ï¼Œå†é™„ä¸Šæ•°å­—è¯ä¹¦å°±è¡Œäº†ã€‚

13.

è‹çŠæ”¶ä¿¡åï¼Œç”¨CAçš„å…¬é’¥è§£å¼€æ•°å­—è¯ä¹¦ï¼Œå°±å¯ä»¥æ‹¿åˆ°é²å‹ƒçœŸå®çš„å…¬é’¥äº†ï¼Œç„¶åå°±èƒ½è¯æ˜"æ•°å­—ç­¾å"æ˜¯å¦çœŸçš„æ˜¯é²å‹ƒç­¾çš„ã€‚

14.

ä¸‹é¢ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªåº”ç”¨"æ•°å­—è¯ä¹¦"çš„å®ä¾‹ï¼šhttpsåè®®ã€‚è¿™ä¸ªåè®®ä¸»è¦ç”¨äºç½‘é¡µåŠ å¯†ã€‚

15.

é¦–å…ˆï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘å‡ºåŠ å¯†è¯·æ±‚ã€‚

16.

æœåŠ¡å™¨ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†ç½‘é¡µä»¥åï¼Œè¿åŒæœ¬èº«çš„æ•°å­—è¯ä¹¦ï¼Œä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯ã€‚

17.

å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰çš„"è¯ä¹¦ç®¡ç†å™¨"ï¼Œæœ‰"å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„"åˆ—è¡¨ã€‚å®¢æˆ·ç«¯ä¼šæ ¹æ®è¿™å¼ åˆ—è¡¨ï¼ŒæŸ¥çœ‹è§£å¼€æ•°å­—è¯ä¹¦çš„å…¬é’¥æ˜¯å¦åœ¨åˆ—è¡¨ä¹‹å†…ã€‚

18.

å¦‚æœæ•°å­—è¯ä¹¦è®°è½½çš„ç½‘å€ï¼Œä¸ä½ æ­£åœ¨æµè§ˆçš„ç½‘å€ä¸ä¸€è‡´ï¼Œå°±è¯´æ˜è¿™å¼ è¯ä¹¦å¯èƒ½è¢«å†’ç”¨ï¼Œæµè§ˆå™¨ä¼šå‘å‡ºè­¦å‘Šã€‚

19.

å¦‚æœè¿™å¼ æ•°å­—è¯ä¹¦ä¸æ˜¯ç”±å—ä¿¡ä»»çš„æœºæ„é¢å‘çš„ï¼Œæµè§ˆå™¨ä¼šå‘å‡ºå¦ä¸€ç§è­¦å‘Šã€‚

```





# ä¸‰ã€`HTTPS`

![image-20210828225956253](image-20210828225956253.png)



# å››ã€RSA

RSAæ˜¯ä¸€ç§åŠ å¯†ç®—æ³•ï¼Œæ˜¯ç”±Rï¼ˆRivestï¼‰Sï¼ˆShamir ï¼‰Aï¼ˆAdleman ï¼‰è¿™ä¸‰ä¸ªäººå‘æ˜çš„

https://blog.csdn.net/doujinlong1/article/details/82051986

https://blog.csdn.net/wilsonpeng3/article/details/86636605

## 4.1 æ•°æ®åŠ å¯†æ–¹å¼

ä½¿ç”¨rsaåŠ å¯†ç®—æ³•ï¼Œå®¢æˆ·ç«¯å…¬é’¥åŠ å¯†ï¼ŒæœåŠ¡ç«¯ç§é’¥è§£å¯†
(è‹¥å•æ¬¡ä¼ è¾“æ•°æ®é‡è¿‡å¤§ï¼Œä¹‹åå¯å¼•å…¥aes rsaåªåŠ å¯†ivéƒ¨åˆ†)

æ•°æ®åŠ å¯†æ­¥éª¤
ç¤ºä¾‹ä»£ç ä¸ºpython

#### 1.ä½¿ç”¨zlibå‹ç¼©ç›®æ ‡æ•°æ®

```python
eg:
import zlib
m = zlib.compress(message)
```

#### 2.rsa ç§é’¥ä¸º1024bitï¼Œéœ€å°†è¢«å¯†æ•°æ®åšåˆ†å‰²å¤„ç†

```python
eg:
def format_str(string, width):
    format_list = [string[x:x+width] for x in range(0,len(string),width)]
    return format_list

str_list = format_str(m,117)
```

#### 3.ä½¿ç”¨ç§é’¥åŠ å¯†,base64 encodeæ•°æ®å¹¶å°†\næ›¿æ¢ä¸ºçº¦å®šå­—ç¬¦ä¸²(#dmp#),æœ€åå°†listæŒ‰çº¦å®šåˆ†éš”ç¬¦(#fp#)åˆå¹¶ä¸ºå­—ç¬¦ä¸²

```python
eg:
data_list = []
for _str in str_list:
    data_list.append(base64.encodestring(rsa.encrypt(_str, pubkey)).replace('\n','#dmp#'))
    
encrypt_str = "#fp#".join(data_list)
```



## 4.2 æ•°æ®è§£å¯†æ­¥éª¤

**ç¤ºä¾‹ä»£ç ä¸ºpython**

#### 1.å°†åŠ å¯†çš„æœ€ç»ˆç»“æœæŒ‰ç…§çº¦å®šåˆ†éš”ç¬¦(#xxd#)æ‹†è§£ä¸ºlist,å°†çº¦å®šå­—ç¬¦ä¸²(#dmp#)è¿˜åŸä¸º\n,base64 decodeæ•°æ®,æœ€åä½¿ç”¨ç§é’¥è§£å¯†

```
eg:
data_list = encrypt_str.split("#fp#")
for data in data_list:
    _data_list.append(rsa.decrypt(base64.decodestring(data.replace('#dmp#','\n')), privkey))
```

#### 2.åˆå¹¶listï¼Œä½¿ç”¨zlibè§£å‹æ•°æ®

```
eg:
d = zlib.decompress("".join(_rsa_list))
print(d)

```



# äº”ã€å„ç§åŠ å¯†ç®—æ³•



- å‡ ç§å¯¹ç§°æ€§åŠ å¯†ç®—æ³•ï¼šAES,DES,3DES
	- DESæ˜¯ä¸€ç§åˆ†ç»„æ•°æ®åŠ å¯†æŠ€æœ¯ï¼ˆå…ˆå°†æ•°æ®åˆ†æˆå›ºå®šé•¿åº¦çš„å°æ•°æ®å—ï¼Œä¹‹åè¿›è¡ŒåŠ å¯†ï¼‰ï¼Œé€Ÿåº¦è¾ƒå¿«ï¼Œé€‚ç”¨äºå¤§é‡æ•°æ®åŠ å¯†ï¼Œè€Œ3DESæ˜¯ä¸€ç§åŸºäºDESçš„åŠ å¯†ç®—æ³•ï¼Œä½¿ç”¨3ä¸ªä¸åŒå¯†åŒ™å¯¹åŒä¸€ä¸ªåˆ†ç»„æ•°æ®å—è¿›è¡Œ3æ¬¡åŠ å¯†ï¼Œå¦‚æ­¤ä»¥ä½¿å¾—å¯†æ–‡å¼ºåº¦æ›´é«˜ã€‚ç°åœ¨åŸºæœ¬ä½¿ç”¨AES
- å‡ ç§éå¯¹ç§°æ€§åŠ å¯†ç®—æ³•ï¼šRSA,DSA,ECC
	- RSAå’ŒDSAçš„å®‰å…¨æ€§åŠå…¶å®ƒå„æ–¹é¢æ€§èƒ½éƒ½å·®ä¸å¤šï¼Œè€ŒECCè¾ƒä¹‹åˆ™æœ‰ç€å¾ˆå¤šçš„æ€§èƒ½ä¼˜è¶Šï¼ŒåŒ…æ‹¬å¤„ç†é€Ÿåº¦ï¼Œå¸¦å®½è¦æ±‚ï¼Œå­˜å‚¨ç©ºé—´ç­‰ç­‰
- å‡ ç§çº¿æ€§æ•£åˆ—ç®—æ³•ï¼ˆç­¾åç®—æ³•ï¼‰ï¼šMD5,SHA1,HMAC
	- è¿™å‡ ç§ç®—æ³•åªç”Ÿæˆä¸€ä¸²ä¸å¯é€†çš„å¯†æ–‡ï¼Œç»å¸¸ç”¨å…¶æ•ˆéªŒæ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦ç»è¿‡ä¿®æ”¹ï¼Œå› ä¸ºç›¸åŒçš„ç”Ÿæˆç®—æ³•å¯¹äºåŒä¸€æ˜æ–‡åªä¼šç”Ÿæˆå”¯ä¸€çš„å¯†æ–‡ï¼Œè‹¥ç›¸åŒç®—æ³•ç”Ÿæˆçš„å¯†æ–‡ä¸åŒï¼Œåˆ™è¯æ˜ä¼ è¾“æ•°æ®è¿›è¡Œè¿‡äº†ä¿®æ”¹ã€‚é€šå¸¸åœ¨æ•°æ®ä¼ è¯´è¿‡ç¨‹å‰ï¼Œä½¿ç”¨MD5å’ŒSHA1ç®—æ³•å‡éœ€è¦å‘é€å’Œæ¥æ”¶æ•°æ®åŒæ–¹åœ¨æ•°æ®ä¼ é€ä¹‹å‰å°±çŸ¥é“å¯†åŒ™ç”Ÿæˆç®—æ³•ï¼Œè€ŒHMACä¸ä¹‹ä¸åŒçš„æ˜¯éœ€è¦ç”Ÿæˆä¸€ä¸ªå¯†åŒ™ï¼Œå‘é€æ–¹ç”¨æ­¤å¯†åŒ™å¯¹æ•°æ®è¿›è¡Œæ‘˜è¦å¤„ç†ï¼ˆç”Ÿæˆå¯†æ–‡ï¼‰ï¼Œæ¥æ”¶æ–¹å†åˆ©ç”¨æ­¤å¯†åŒ™å¯¹æ¥æ”¶åˆ°çš„æ•°æ®è¿›è¡Œæ‘˜è¦å¤„ç†ï¼Œå†åˆ¤æ–­ç”Ÿæˆçš„å¯†æ–‡æ˜¯å¦ç›¸åŒã€‚

RSAå»ºè®®é‡‡ç”¨1024ä½çš„æ•°å­—ï¼ŒECCå»ºè®®é‡‡ç”¨160ä½ï¼ŒAESé‡‡ç”¨128ä¸ºå³å¯ã€‚



# å…­ã€ HTTPSçš„å®ç°åŸç†

å¤§å®¶å¯èƒ½éƒ½å¬è¯´è¿‡ HTTPS åè®®ä¹‹æ‰€ä»¥æ˜¯å®‰å…¨çš„æ˜¯å› ä¸º HTTPS åè®®ä¼šå¯¹ä¼ è¾“çš„æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œè€ŒåŠ å¯†è¿‡ç¨‹æ˜¯ä½¿ç”¨äº†éå¯¹ç§°åŠ å¯†å®ç°ã€‚ä½†å…¶å®ï¼šHTTPS åœ¨å†…å®¹ä¼ è¾“çš„åŠ å¯†ä¸Šä½¿ç”¨çš„æ˜¯å¯¹ç§°åŠ å¯†ï¼Œéå¯¹ç§°åŠ å¯†åªä½œç”¨åœ¨è¯ä¹¦éªŒè¯é˜¶æ®µã€‚

### 6.1 HTTPS å®ç°åŸç†

![image-20210911084808822](image-20210911084808822.png)

æå‡ºä¸€ä¸ªé—®é¢˜å“ˆï¼šå¦‚æœæˆ‘æ‹¦æˆªäº† è¿”å›çš„è¯ä¹¦å’Œå…¬é’¥ï¼Œå¯ä»¥ä¼ªè£…æ”»å‡»ï¼Ÿ

ç­”æ¡ˆ:  èƒ½ï¼Œè¯·çœ‹charlesçš„å·¥ä½œåŸç†

åšå®¢ï¼šhttps://www.cnblogs.com/xiaonian8/p/13761230.html

åšå®¢ï¼ˆcharlesï¼‰ï¼šhttps://www.jianshu.com/p/3941410f7378



### 6.2 charleså’Œfiddlerå®ç°æŠ“åŒ…çš„åŸç†

`Charles`ä½œä¸ºä¸€ä¸ªâ€œä¸­é—´äººä»£ç†â€ï¼Œå½“æµè§ˆå™¨å’ŒæœåŠ¡å™¨é€šä¿¡æ—¶ï¼Œ`Charles`æ¥æ”¶æœåŠ¡å™¨çš„è¯ä¹¦ï¼Œä½†åŠ¨æ€ç”Ÿæˆä¸€å¼ è¯ä¹¦å‘é€ç»™æµè§ˆå™¨ï¼Œä¹Ÿå°±æ˜¯è¯´`Charles`ä½œä¸ºä¸­é—´ä»£ç†åœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´é€šä¿¡ï¼Œæ‰€ä»¥é€šä¿¡çš„æ•°æ®å¯ä»¥è¢«`Charles`æ‹¦æˆªå¹¶è§£å¯†ã€‚ç”±äº`Charles`æ›´æ”¹äº†è¯ä¹¦ï¼Œæµè§ˆå™¨æ ¡éªŒä¸é€šè¿‡ä¼šç»™å‡ºå®‰å…¨è­¦å‘Šï¼Œå¿…é¡»å®‰è£…`Charles`çš„è¯ä¹¦åæ‰èƒ½è¿›è¡Œæ­£å¸¸è®¿é—®ã€‚

è¿”å›è¯ä¹¦çš„åŒæ—¶è¿˜ä¼šå°†æœåŠ¡å™¨çš„å…¬é’¥å‘é€ç»™å®¢æˆ·ç«¯

![image-20210911090132725](image-20210911090132725.png)







# ä¸ƒã€FiddleræŠ“ä¸åˆ°çš„åŒ…æ˜¯æ€ä¹ˆå›äº‹

### 1.åˆ†æåŸå› 

çŸ¥å·±çŸ¥å½¼ï¼Œç™¾æˆ˜ä¸æ®†ã€‚è¦ææ¸…æ¥šæ˜¯æ€ä¹ˆå›äº‹ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯è‡ªå·±å†™ä¸€ä¸ªç¨‹åºï¼Œè¿›è¡ŒHTTPSè¯·æ±‚ï¼Œç„¶åé€šè¿‡æ­¤æ–¹æ³•æŠ“è‡ªå·±çš„åŒ…ï¼Œçœ‹çœ‹å“ªä¸ªåœ°æ–¹å‡ºé”™ã€‚äºæ˜¯ç”¨æœ€ç®€å•çš„Pythonä»£ç è¿›è¡Œæµ‹è¯•ï¼šï¼ˆå‰ç½®æ¡ä»¶ï¼šå¼€å¯æˆ‘ä»¬çš„fiddlerï¼‰

```python
import requests
url = 'https://www.baidu.com/'
res = requests.get(url=url)
```

ç„¶è€Œä¼šæŠ¥å¦‚ä¸‹é”™è¯¯

```python
Traceback (most recent call last):
  File "C:\Users\zmz\AppData\Local\Programs\Python\Python36\lib\site-packages\urllib3\connectionpool.py", line 667, in urlopen
    self._prepare_proxy(conn)
  File "C:\Users\zmz\AppData\Local\Programs\Python\Python36\lib\site-packages\urllib3\connectionpool.py", line 932, in _prepare_proxy
    conn.connect()
  File "C:\Users\zmz\AppData\Local\Programs\Python\Python36\lib\site-packages\urllib3\connection.py", line 371, in connect
    ssl_context=context,
  File "C:\Users\zmz\AppData\Local\Programs\Python\Python36\lib\site-packages\urllib3\util\ssl_.py", line 384, in ssl_wrap_socket
    return context.wrap_socket(sock, server_hostname=server_hostname)
  File "C:\Users\zmz\AppData\Local\Programs\Python\Python36\lib\ssl.py", line 407, in wrap_socket
    _context=self, _session=session)
  File "C:\Users\zmz\AppData\Local\Programs\Python\Python36\lib\ssl.py", line 814, in __init__
    self.do_handshake()
  File "C:\Users\zmz\AppData\Local\Programs\Python\Python36\lib\ssl.py", line 1068, in do_handshake
    self._sslobj.do_handshake()
  File "C:\Users\zmz\AppData\Local\Programs\Python\Python36\lib\ssl.py", line 689, in do_handshake
    self._sslobj.do_handshake()
ssl.SSLError: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:841)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zmz\AppData\Local\Programs\Python\Python36\lib\site-packages\requests\adapters.py", line 449, in send
    timeout=timeout
  File "C:\Users\zmz\AppData\Local\Programs\Python\Python36\lib\site-packages\urllib3\connectionpool.py", line 727, in urlopen
    method, url, error=e, _pool=self, _stacktrace=sys.exc_info()[2]
  File "C:\Users\zmz\AppData\Local\Programs\Python\Python36\lib\site-packages\urllib3\util\retry.py", line 439, in increment
    raise MaxRetryError(_pool, url, error or ResponseError(cause))
urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='www.baidu.com', port=443): Max retries exceeded with url: / (Caused by SSLError(SSLError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:841)'),))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "<pyshell#3>", line 1, in <module>
    res = requests.get(url=url)
  File "C:\Users\zmz\AppData\Local\Programs\Python\Python36\lib\site-packages\requests\api.py", line 76, in get
    return request('get', url, params=params, **kwargs)
  File "C:\Users\zmz\AppData\Local\Programs\Python\Python36\lib\site-packages\requests\api.py", line 61, in request
    return session.request(method=method, url=url, **kwargs)
  File "C:\Users\zmz\AppData\Local\Programs\Python\Python36\lib\site-packages\requests\sessions.py", line 530, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\zmz\AppData\Local\Programs\Python\Python36\lib\site-packages\requests\sessions.py", line 643, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\zmz\AppData\Local\Programs\Python\Python36\lib\site-packages\requests\adapters.py", line 514, in send
    raise SSLError(e, request=request)
requests.exceptions.SSLError: HTTPSConnectionPool(host='www.baidu.com', port=443): Max retries exceeded with url: / (Caused by SSLError(SSLError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:841)'),))
```

æˆ‘ä»¬çœ‹çœ‹æœ€åçš„tracebackï¼Œæˆ‘ä»¬å‘ç° raise SSLError(e, request=request)ï¼Œæ ¹æ®ä¸Šé¢charleså’Œfiddlerå®ç°æŠ“åŒ…çš„åŸç†ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œfiddlerä¸­ä¸ºä¸­é—´äººä»£ç†ï¼Œä¼šå°†è‡ªå·±çš„è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ã€‚ä¹‹å‰è¯´åˆ°ï¼ŒFiddlerä¹‹æ‰€ä»¥èƒ½æŠ“åˆ°å¹¶è§£å¯†HTTPSåŒ…çš„å†…å®¹ï¼Œæ˜¯å› ä¸ºFiddlerä½¿ç”¨äº†ä¸­é—´äººæ”»å‡»çš„æ‰‹æ®µï¼Œè¯¥æ‰‹æ®µè¦èƒ½æˆåŠŸå®æ–½ï¼Œæœ‰ä¸€ä¸ªå‰ææ¡ä»¶ï¼Œå°±æ˜¯å®¢æˆ·ç«¯ä¿¡ä»»Fiddleræä¾›çš„æ ¹è¯ä¹¦ï¼Œä¹‹å‰æˆ‘ä»¬é€šè¿‡ [Actions] â€” [Trust Root Certificate] è®©ç³»ç»Ÿä¿¡ä»»Fiddlerçš„æ ¹è¯ä¹¦åï¼Œå¤§éƒ¨åˆ†æµè§ˆå™¨ä»¥åŠåŸºäºWinInetåº“è¿›è¡ŒHTTPé€šä¿¡çš„ç¨‹åºï¼Œéƒ½ä¼šä¿¡ä»»æ“ä½œç³»ç»Ÿä¸­æˆ‘ä»¬æ·»åŠ çš„Fiddleræ ¹è¯ä¹¦ã€‚ä½†å¦‚æœç¬¬ä¸‰æ–¹ç¨‹åºä½¿ç”¨å…¶å®ƒHTTPåº“è¿›è¡Œé€šä¿¡ï¼Œæ¯”å¦‚VCç¨‹åºä½¿ç”¨libcurlï¼ŒJAVAç¨‹åºä½¿ç”¨JDKä¸­çš„URLConnectionæˆ–ç¬¬ä¸‰æ–¹OkHttpï¼ŒC#ä½¿ç”¨System.Net.Httpï¼ŒPythonä½¿ç”¨requestsï¼Œè¿™äº›HTTPåº“ä¸€èˆ¬è‡ªå¸¦äº†ä¸€å¥—å¯ä¿¡ä»»çš„SSLæ ¹è¯ä¹¦ï¼Œå®ƒä»¬ä¸ä½¿ç”¨æ“ä½œç³»ç»Ÿè‡ªå¸¦çš„SSLæ ¹è¯ä¹¦ï¼Œæ›´ä¸ä¼šä½¿ç”¨æˆ‘ä»¬å‘æ“ä½œç³»ç»Ÿä¸­æ·»åŠ çš„Fiddleræ ¹è¯ä¹¦ï¼Œäºæ˜¯å°±éªŒè¯å‡ºé”™äº†ã€‚
ä»¥Pythonä¸ºä¾‹ï¼Œè¿™ä¸€ç‚¹å¯ä»¥åœ¨requestsæ–‡æ¡£ä¸­å¾—åˆ°è¯å®ï¼š

### 2.è§£å†³åŠæ³•

é‚£ä¹ˆè§£å†³çš„åŠæ³•æœ‰ä¸¤ç§

#### 2.1 ä¸€ç§æ˜¯è®©HTTPå®¢æˆ·ç«¯ç¦ç”¨è¯ä¹¦éªŒè¯ï¼š

```python
import requests
requests.get("https://www.baidu.com/", verify = False)
```

ä½†æ˜¯è¿˜æ˜¯æŠ¥é”™äº†

```python
Warning (from warnings module):
  File "C:\Users\zmz\AppData\Local\Programs\Python\Python36\lib\site-packages\urllib3\connectionpool.py", line 988
    InsecureRequestWarning,
InsecureRequestWarning: Unverified HTTPS request is being made to host '127.0.0.1'. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
```

ç»™æˆ‘ä»¬è­¦å‘Šäº†ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼šå¼ºçƒˆå»ºè®®æ·»åŠ è¯ä¹¦éªŒè¯

#### 2.2 è®©HTTPå®¢æˆ·ç«¯ä¿¡ä»»Fiddlerçš„æ ¹è¯ä¹¦

**æ“ä½œæ­¥éª¤ï¼š**

**ç¬¬ä¸€æ­¥ï¼šæ‰“å¼€fiddler**

**ç¬¬äºŒæ­¥ï¼šè®¿é—®ç½‘ç«™ [http://127.0.0.1:8888](http://127.0.0.1:8888/)**

å½“æˆ‘ä»¬å¼€å¯fiddlerä»¥åï¼Œä»–ä¼šè‡ªåŠ¨å»ç»™æˆ‘ä»¬è®¾ç½®ç³»ç»Ÿä»£ç†ï¼Œä»£ç†ç«¯å£å°±æ˜¯8888

![image-20210911105949095](image-20210911105949095.png)

**ç¬¬ä¸‰æ­¥ï¼šç‚¹å‡»http://127.0.0.1:8888/é¡µé¢ä¸­çš„`FiddlerRoot certificate`ä¸‹è½½è¯ä¹¦å¾—åˆ°å¦‚ä¸‹æ–‡ä»¶**

![image-20210911110124597](image-20210911110124597.png)



**ç¬¬å››æ­¥ï¼šè½¬æ¢æˆpythonæ”¯æŒçš„æ ¼å¼**

ç”¨opensslè½¬æ¢æˆPython requestsæ”¯æŒçš„æ ¼å¼ï¼š

```python
openssl x509 -inform der -in FiddlerRoot.cer -out fiddler.pem
```



**ç¬¬äº”æ­¥ï¼šè½¬æ¢è¯ä¹¦æ ¼å¼**

ç”±äºwindowç¯å¢ƒä¸‹æ˜¯æ²¡æœ‰opensslå®‰è£…åŒ…çš„ï¼Œæˆ‘ä»¬è¿™æ˜¯éœ€è¦ä¸€å°æœåŠ¡å™¨ï¼ˆæˆ‘è‡ªå·±ä¹°çš„åä¸ºäº‘ï¼‰

ä¸‹è½½openssl

å®˜æ–¹ä¸‹è½½åœ°å€ï¼š[ https://www.openssl.org/source/](https://www.openssl.org/source/)

![image-20210911110357989](image-20210911110357989.png)



**ç¬¬å…­æ­¥ï¼šå°†æˆ‘ä»¬ä¸‹è½½åœ¨windowç”µè„‘ä¸Šçš„openssl-3.0.0.tar.gzåŒ…ä¸Šä¼ åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Š**

åœ¨linuxç¯å¢ƒä¸‹ä½¿ç”¨rzå‘½ä»¤ä¸Šä¼ 

```bash
rz 
```

è§£å‹

```bash
tar -zxvf openssl-3.0.0.tar.gz
```

ä¸Šä¼ è¯ä¹¦åˆ°linuxæœåŠ¡å™¨ä¸Š

```bash
rz
```

è½¬åŒ–æ ¼å¼ï¼Œç”Ÿæˆfiddler.pemæ–‡ä»¶

```BASH
openssl x509 -inform der -in FiddlerRoot.cer -out fiddler.pem
```

å°†fiddler.pemæ–‡ä»¶ï¼Œå¯¼å‡ºåˆ°windowsæœºå™¨ä¸Šçš„æ¡Œé¢ä¸Š

```bash
sz fiddler.pem
```



**ç¬¬ä¸ƒæ­¥ï¼šå†æ¬¡æ‰§è¡Œpythonå‘½ä»¤**

```bash
import requests
res = requests.get("https://www.baidu.com/", verify='C://Users//zmz//Desktop//fiddler.pem')
```

è¿™æ¬¡æˆåŠŸäº†