![image-20220214224936550](image-20220214224936550.png)





```python
# 进入系统模式
system-view						

# 给交换机创建一个名字（这一步不需要哈）
sysname s5700					

# 给交换机创建2个VLAN 10和20
vlan batch 10 20				

# 进入接口
interface GigabitEthernet 0/0/1	

# 修改端口类型为access口
port link-type access

# 将该端口加入到VLAN 10 (所有带 vlan 10 的数据都可以访问)
port default vlan 10

# 退出
quit

# 进入接口
interface GigabitEthernet 0/0/2

# 修改端口类型为access口
port link-type access

# 将该端口加入到VLAN 10 (所有带 vlan 10 的数据都可以访问)
port default vlan 20

# 退出
quit

# 进去vlanif10三层接口
interface Vlanif 10

# 配置vlanif 三层接口的网关地址
ip address 10.32.73.254 24

# 退出
quit

# 进去vlanif20三层接口
interface Vlanif 20

# 配置vlanif 三层接口的网关地址（必须将一个接口划入到vlan下以后才可以配置vlanif，不然命令都敲不出来）
ip address ip address 192.168.8.254 24

# 配置主机PC1的IP地址(主机的网关地址要和vlanif10的网关地址保持一致)
IP 10.32.73.8
netmark 255.255.255.0
gateway 10.32.73.254

# 配置主机PC2的IP地址(主机的网关地址要和vlanif20的网关地址保持一致)
IP 192.168.8.85
netmark 255.255.255.0
gateway 192.168.8.254

# 🔺配置了vlanif以后，该接口只能是
```

![image-20220214232455609](image-20220214232455609.png)



作用：
只是在交换机从外部接收到Untagged数据帧时，用于在数据帧有便签情况下判断是否接受该数据帧/无便签情况下给数据帧添加便签用的。

Hybrid类型接口的PVID是可以手动更改的。
华为设备通过命令 port hybrid pvid vlan xx;



Access类型接口将接口划进某一个VLAN时，接口的PVID也随之改变。



Trunk类型的接口的PVID也是可以手动改的。
华为设备通过命令 port trunk pvid vlan xx;



普通交换机的二层端口有三种常见的端口类型：access、trunk、hybird，

access端口一般用作PC或服务器主机接入，通过该端口的数据包都是不带VLAN tag的；

trunk端口可以允许多个VLAN的数据包通过，一般连接其他交换机；

hybird端口比较灵活，可以根据用户需求，对通过该端口的数据包进行VLAN tag打标和去标动作，可以连主机也可以连其他交换机；在开始讲解之前，**请记住交换机内部的所有数据报文是有VLAN tag的，**

下面我们通过分析交换机端口的进、出两个方向对VLAN tag的处理过程来详细说明这三种端口类型的区别；

access端口：

    通过access出去的数据包都是不带VLAN tag的；
    
    在access端口进方向，交换机接收到数据包后，先判断是否带VLAN tag，有则丢弃数据包，没有则打上该端口已配置的VLAN tag；
    
    在access端口出方向，交换机将打了与端口相同VLAN tag的数据包转发出去，并且去掉VLAN tag变成普通数据包。

 这里有一个现象：如果收到了和自己vlan相同的带标签的数据。access口允许同vlan进入，但是接口都是成对的，如果access口接收到同vlan数据，表明对端是trunk口（或者hybrid），数据从trunk口进入access口没问题，但应答数据从access口出去后，会剥离标签，此时再进入trunk口，会打上trunk口的pvid（因为该数据从trunk到access的过程中带有vlan，说明pvid和原有vlan不一样），此时应答数据带有的vlan已经和原有vlan不一样了，所以是无法通讯的。总的来说，一端access，一端trunk，是不合理的网络拓扑








trunk端口：https://blog.csdn.net/yangnianlong/article/details/104267180

```python
通过trunk端口的数据包都必须带上VLAN tag；

在trunk端口进方向，交换机接收到数据包后，先判断是否带VLAN tag，没有则丢弃数据包，有则按照对应VLAN进行转发；

在trunk端口出方向，交换机将带VLAN tag的数据包原封不动转发出去，没有带VLAN tag数据包不会从trunk端口转发出去。

在trunk端口上有一种特殊情况，如果配置了native VLAN（也叫PVID），转发方式等同于access端口，当从端口进来的报文不带vlan tag时，就打上Native vlan tag； 当从端口出去的报文带Native vlan tag时，会剥离TAG。
```



hybird端口：

```python
顾名思义，这是一种混合端口，是access和trunk两种端口的混合，既可以转发无vlan tag报文，也可以转发有vlan tag报文；在hybird端口上通常会配置tag vlan和untag vlan，对于tag vlan，其转发方式与trunk口相同，对于untag vlan，其转发方式与access口相同；

在hybird端口进方向，交换机接收到数据包后，先判断是否带VLAN tag，没有则丢弃，如果没有vlan tag但是配置了PVID，则打上PVID的vlan tag；有则按照对应VLAN进行转发；进方向不看untag配置；

在hybird端口出方向，对于配置了tag vlan的数据包，原封不动发送出去，对于端口配置了untag vlan的数据包，则去掉vlan tag再发送出去；如果是PVID的vlan，则去掉vlan tag再发送出去；
```











```python
# 删除vlanif（删除以后同时也会删除vlanif配置的ip）
undo interface vlanif 10

# 开启vlanif
interface vlanif 10

# 删除vlan(删除VLAN必须先删除vlanif)
undo vlan 10

# 删除access类型
undo port link-type access

# 查看vlan
display vlan

# 查看端口的具体vlan pvid allow-pass 详情
display port vlan

# 进入vlanif
interface vlanif 10
dis this	#查看vlanif三层接口配置
```

需要一层一层的来删除配置，直到恢复到默认的配置。

比如：

配置的时候为：

port link-type access

port default vlan 4

如果直接更改端口模式就会报错为Error: Please renew the default configurations.

所以如果出现这种错误，在这里就需要从后往前删除,即：

undo port default vlan 4

undo port link-type

到这里以后 才可以重新更改端口的模式。



当交换机的接口类型为access类型时，pid＝pvid,也就是说不用任何命令来设置。
pvid这个参数只针对于 trunk、hybird口来说才有意义，对于access口来说没有意义







**S系列交换机配置Trunk口**

```python
# 进入端口
[SW1]interface Ethernet 0/0/1

# 配置类型
[SW1-Ethernet0/0/1]port link-type trunk

# 配置allow-pass vlan(vlan可以不存在，但是必须合法)
[SW1-Ethernet0/0/1]port trunk allow-pass vlan 10 20

# 添加allow-pass vlan (vlan可以不存在，但是必须合法)
[SW1-Ethernet0/0/1]port trunk allow-pass vlan 30

# 删除其中一个vlan
[SW1-Ethernet0/0/1]undo port trunk allow-pass vlan 30

# 删除allow-pass（删除全部vlan以后就删除了 allow-pass了）
[SW1-Ethernet0/0/1]undo port trunk allow-pass vlan 10 20

# 配置PVID(vlan必须存在)
[SW1-Ethernet0/0/1]port trunk pvid vlan 10
```







**CE系列**

```python
# 必须开启端口
interface CE 0/0/1

# 开启端口
undo shutdown

# 提交(CE系列交换机必须提交任务，不然不生效)
commit
```

